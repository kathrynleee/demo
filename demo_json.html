<html>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.17.1/cytoscape.min.js"></script>
<style>
    @font-face {
        font-family: themeFont;
        src: url('font.ttf');
    }
    #cy {
        height: 100%;
        width: 100%;
        position: absolute;
        left: 0;
        top: 0;
    }
</style>

<body>
    <div id="cy"></div>
</body>
    
<script>
    $.getJSON('data.js', function (data) {
        var cy = cytoscape({
            container: $('#cy'),
            style: cytoscape.stylesheet()
                .selector('node')
                .css({
                    'label': 'data(name)',
                    'background-color': '#97bbc9',
                    'text-valign': 'top',
                    'color': '#3368a1',
                    'font-size' : '25',
                    'font-family': 'themeFont',
                    'text-wrap': 'wrap',
                    'width' : '30px' ,
                    'height': '30px'
            })
                .selector('edge')
                .css({
                    'line-color': '#97bbc9',
                    'width': 2,
                    'target-arrow-color': '#97bbc9',
                    'target-arrow-shape': 'triangle',
                    'curve-style': 'bezier'
            })
                .selector('.target')
                .css({
                    'background-color': '#f2948d',
                    'color': '#f2948d',
                    'font-family': 'themeFont'
            })
                .selector('.faded')
                .css({
                    'opacity': '0.2',
                    'text-opacity': 0
            })
                .selector('node.highlight')
                .css({
                    'background-color': '#3368a1',
                    'color': '#3368a1',
                    'font-family': 'themeFont'
            })
                .selector('edge.highlight')
                .css({
                    'target-arrow-color': '#3368a1',
                    'line-color': '#3368a1'
            }),
            elements: data
        });
    
        // get node info
        cy.on('tap', 'node', function(e) {
            console.log(cy.elements().jsons());
            cy.elements().removeClass(['highlight','faded','target']);
            var target = e.target;
            var node = target[0]._private.data;
            console.log( 'tapped ' , node.name);
//            var test = (cy.elements().difference(target.outgoers()).not(target));
//            $.each(test, function() {
//                console.log(this._private.data.name);
//            });
//            var test2 = target.outgoers();
//            $.each(test2, function() {
//                console.log(this._private.data.name);
//            });
            cy.elements().difference(target.predecessors().union(target.successors())).not(target).addClass('faded');
            target.union(target.predecessors()).union(target.successors()).addClass('highlight');
            
            // neighbours
            //cy.elements().difference(target.neighborhood()).not(target).addClass('faded');
            //target.union(target.neighborhood()).addClass('highlight');
            // target.neighborhood().addClass('highlight');
            
            target.addClass('target');
        });
        
//        // click on nodes
//        cy.on('tap', 'node', function (e) {
//            cy.elements().removeClass('highlight');
//            var node = e.target;
//             // alert(e.target.id())
//            // predecessors successors incomers outgoers
//            node.outgoers().nodes().addClass('highlight');
//        });
//    
//        // click on background
        cy.on('click', function(e) {
            if (e.target === cy) {
                cy.elements().removeClass(['highlight','faded','target']);
            }
        });
    }); // on dom ready
</script>
</html>
